(function(w,E,e,A,t,M,z,h,I,d){"use strict";var y={Failed:h.getAssetIDByName("Small"),Delete:h.getAssetIDByName("ic_message_delete"),Copy:h.getAssetIDByName("toast_copy_link"),Open:h.getAssetIDByName("ic_leave_stage"),Clipboard:h.getAssetIDByName("pending-alert"),Clock:h.getAssetIDByName("clock"),Forum:h.getAssetIDByName("ic_forum_channel"),Settings:{Toasts:{Settings:h.getAssetIDByName("ic_selection_checked_24px"),Failed:h.getAssetIDByName("ic_close_circle_24px")},Initial:h.getAssetIDByName("coffee"),Update:h.getAssetIDByName("discover"),Locale:h.getAssetIDByName("ic_locale_24px"),External:h.getAssetIDByName("ic_raised_hand_list"),Edit:h.getAssetIDByName("ic_edit_24px"),Reply:h.getAssetIDByName("ic_reply_24px"),Keyboard:h.getAssetIDByName("ic_keyboard_24px")}},R={shadow:function(a=.1){return{shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:a,shadowRadius:4.65,elevation:8}},displayToast:function(a,r){e.toasts.open({content:r=="clipboard"?`Copied ${a} to clipboard.`:a,source:r=="clipboard"?y.Clipboard:y.Settings.Initial})}},v={plugin:{source:"https://github.com/MYSTRAVIL/vendetta-plugins"},author:{profile:{"Rosie<3":"https://github.com/acquitelol"}}};const{TouchableOpacity:N,View:L,Image:q,Text:x,Animated:S}=M.General,$=E.findByProps("transitionToGuild"),_=E.findByStoreName("UserStore"),X=E.findByProps("showUserProfile"),b=e.stylesheet.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...R.shadow()},image:{width:75,height:75,borderRadius:10,...R.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:I.semanticColors.HEADER_PRIMARY,fontFamily:e.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:I.semanticColors.HEADER_SECONDARY,fontSize:12.75}});function J({name:a,authors:r}){const s=e.React.useRef(new S.Value(1)).current,n=function(){return S.spring(s,{toValue:1.1,duration:10,useNativeDriver:!0}).start()},l=function(){return S.spring(s,{toValue:1,duration:250,useNativeDriver:!0}).start()},c=function(){return X.showUserProfile({userId:_.getCurrentUser().id})},i={transform:[{scale:s}]};return e.React.createElement(e.React.Fragment,null,e.React.createElement(L,{style:b.container},e.React.createElement(N,{onPress:c,onPressIn:n,onPressOut:l},e.React.createElement(S.View,{style:i},e.React.createElement(q,{style:[b.image],source:{uri:_?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),e.React.createElement(L,{style:b.textContainer},e.React.createElement(N,{onPress:function(){return $.openURL(v.plugin.source)}},e.React.createElement(x,{style:[b.mainText,b.header]},a)),e.React.createElement(L,{style:{flexDirection:"row"}},e.React.createElement(x,{style:[b.mainText,b.subHeader]},"A project by"),r.map(function(u,o,p){return e.React.createElement(N,{onPress:function(){return $.openURL(v.author.profile[u.name]??"https://github.com/")}},e.React.createElement(x,{style:[b.mainText,b.subHeader,{paddingLeft:4,fontFamily:e.constants.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},u.name,o<p.length-1?",":null))})))))}const{View:Q,Text:Z}=M.General,V=e.stylesheet.createThemedStyleSheet({text:{color:I.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:12}});function Y({label:a,children:r}){return e.React.createElement(Q,{style:{marginTop:10}},e.React.createElement(Z,{style:[V.text,V.optionText]},a.toUpperCase()),r)}const{FormRow:f,FormSwitch:D,FormDivider:C,FormInput:ee,FormText:te}=M.Forms,{ScrollView:ae,View:U,Text:re}=M.General,T=e.stylesheet.createThemedStyleSheet({icon:{color:I.semanticColors.INTERACTIVE_NORMAL},item:{color:I.semanticColors.TEXT_MUTED,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:I.semanticColors.BACKGROUND_MOBILE_SECONDARY,...R.shadow()},subheaderText:{color:I.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}});function se(){t.storage.tapUsernameMention===void 0&&(t.storage.tapUsernameMention=!1),t.storage.reply===void 0&&(t.storage.reply=!0),t.storage.userEdit===void 0&&(t.storage.userEdit=!0),t.storage.keyboardPopup===void 0&&(t.storage.keyboardPopup=!0),t.storage.delay===void 0&&(t.storage.delay="1000"),z.useProxy(t.storage);const a=e.ReactNative.Platform.OS==="android",r=function(n){/^\d*$/.test(n)&&(t.storage.delay=n)},s=function(){try{e.ReactNative.Linking&&e.ReactNative.Linking.openURL?e.ReactNative.Linking.openURL(v.plugin.source):R.displayToast("Cannot open URL: Linking not available","error")}catch(n){R.displayToast("Error opening URL","error"),console.error("Error opening URL:",n)}};return e.React.createElement(ae,null,e.React.createElement(J,{name:t.manifest.name,authors:t.manifest.authors}),e.React.createElement(U,{style:{marginTop:20}},e.React.createElement(Y,{label:"Preferences"},e.React.createElement(U,{style:[T.container]},e.React.createElement(f,{label:"Tap Username to Mention",subLabel:`Allows you to tap on a username to mention them instead of opening their profile.${a?" This option is disabled on Android.":""}`,onLongPress:function(){return R.displayToast("By default, Discord opens a profile when tapping on a username in chat. With this, it now mentions them, like on Android.","tooltip")},leading:e.React.createElement(f.Icon,{style:T.icon,source:t.storage.tapUsernameMention?y.Forum:y.Failed}),trailing:e.React.createElement(D,{value:a?!1:t.storage.tapUsernameMention,onValueChange:function(){a||(t.storage.tapUsernameMention=!t.storage.tapUsernameMention)}}),disabled:a}),e.React.createElement(C,null),e.React.createElement(f,{label:"Double Tap To Reply",subLabel:"Allows you to double tap on any messages to reply to them.",onLongPress:function(){return R.displayToast("Double tapping anyones message allows you to reply to them!","tooltip")},leading:e.React.createElement(f.Icon,{style:T.icon,source:t.storage.reply?y.Settings.Reply:y.Failed}),trailing:e.React.createElement(D,{value:t.storage.reply,onValueChange:function(){t.storage.reply=!t.storage.reply}})}),e.React.createElement(C,null),e.React.createElement(f,{label:"Open Keyboard Automatically",subLabel:"Opens the Keyboard when you reply to or edit a message with a double tap.",onLongPress:function(){return R.displayToast("Opens the Keyboard when you reply to or edit a message with a double tap.","tooltip")},leading:e.React.createElement(f.Icon,{style:T.icon,source:t.storage.keyboardPopup?y.Settings.Keyboard:y.Failed}),trailing:e.React.createElement(D,{value:t.storage.keyboardPopup,onValueChange:function(){t.storage.keyboardPopup=!t.storage.keyboardPopup}})}),e.React.createElement(C,null),e.React.createElement(f,{label:`${t.storage.userEdit?"Double tap to edit":"Double tap to reply to"} your own messages`,subLabel:`Allows you to double tap on any of your own messages to ${t.storage.userEdit?"edit":"reply to"} them.`,onLongPress:function(){return R.displayToast(`When double tapping on any of your own messages, you can now ${t.storage.userEdit?"edit them":"reply to them"}!`,"tooltip")},leading:e.React.createElement(f.Icon,{style:T.icon,source:t.storage.userEdit?y.Settings.Edit:y.Settings.Reply}),trailing:e.React.createElement(D,{value:t.storage.userEdit,onValueChange:function(){t.storage.userEdit=!t.storage.userEdit}})}),e.React.createElement(C,null),e.React.createElement(ee,{value:t.storage.delay,onChange:r,placeholder:"1000",title:"Maximum Delay",keyboardType:"numeric"}),e.React.createElement(C,null),e.React.createElement(te,{style:{padding:10}},"The maximum delay between taps until the double tap event is cancelled. This is 300ms by default."))),e.React.createElement(Y,{label:"Source"},e.React.createElement(U,{style:T.container},e.React.createElement(f,{label:"Source",subLabel:`Open the repository of ${t.manifest.name} externally.`,onLongPress:function(){return R.displayToast(`Opens the repository of ${t.manifest.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip")},leading:e.React.createElement(f.Icon,{style:T.icon,source:y.Open}),trailing:function(){return e.React.createElement(f.Arrow,null)},onPress:s})))),e.React.createElement(re,{style:T.subheaderText},`Build: (${t.manifest.hash?.substring(0,8)||"dev"}`))}const K=E.findByProps("insertText"),W=E.findByStoreName("ChannelStore"),O=E.findByStoreName("MessageStore"),G=E.findByStoreName("UserStore"),j=E.findByProps("sendMessage","startEditMessage"),F=E.findByProps("createPendingReply");let B;try{B=E.findByProps("MessagesHandlers")}catch{d.logger.warn("BetterChatGestures: Could not find MessagesHandlers via findByProps")}if(!B)try{const a=window.vendetta?.metro?.cache||new Map;for(const[r,s]of a)if(s?.exports?.MessagesHandlers){B=s.exports,d.logger.log("BetterChatGestures: Found MessagesHandlers via cache iteration");break}}catch(a){d.logger.error("BetterChatGestures: Failed to find MessagesHandlers via cache",a)}const P=B?.MessagesHandlers,ne={unpatchGetter:null,unpatchHandlers:null,currentTapIndex:0,currentMessageID:null,timeoutTap:null,patches:[],handlersInstances:new WeakSet,doubleTapState({state:a="UNKNOWN",nativeEvent:r}){try{const s={state:a,data:r};a==="INCOMPLETE"&&r&&Object.assign(s,{reason:{required:{taps:2,isAuthor:!0},received:{taps:r.taps,isAuthor:r.isAuthor}}});const n=G?.getCurrentUser();n&&t.manifest.authors.find(function(l){return l.id===n.id})&&console.log("DoubleTapState",s)}catch(s){d.logger.error("BetterChatGestures: Error in doubleTapState",s)}},resetTapState(){try{this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null),this.currentTapIndex=0,this.currentMessageID=null}catch(a){d.logger.error("BetterChatGestures: Error in resetTapState",a)}},openKeyboard(){},patchHandlers(a){var r=this;if(!this.handlersInstances.has(a)){this.handlersInstances.add(a);try{if(a.handleDoubleTapMessage){const s=A.instead("handleDoubleTapMessage",a,function(n,l){try{if(!n?.[0]?.nativeEvent)return;const{nativeEvent:c}=n[0],i=c.channelId,u=c.messageId;if(!i||!u)return;const o=W?.getChannel(i),p=O?.getMessage(i,u);if(!p)return;const g=G?.getCurrentUser();g&&p.author&&p.author.id===g.id&&t.storage.userEdit?j?.startEditMessage(i,u,p.content||""):t.storage.reply&&o&&F?.createPendingReply({channel:o,message:p,shouldMention:!0}),r.openKeyboard();return}catch(c){d.logger.error("BetterChatGestures: Error in handleDoubleTapMessage patch",c)}});this.patches.push(s)}if(a.handleTapUsername&&t.storage.tapUsernameMention){const s=A.instead("handleTapUsername",a,function(n,l){try{if(!t.storage.tapUsernameMention||!n?.[0]?.nativeEvent)return l.apply(a,n);const c=K?.refs?.[0]?.current,{messageId:i}=n[0].nativeEvent;if(!c?.props?.channel?.id)return l.apply(a,n);const u=O.getMessage(c.props.channel.id,i);if(!u?.author)return l.apply(a,n);const o=u.author.discriminator!=="0"?`#${u.author.discriminator}`:"";K.insertText(`@${u.author.username}${o}`)}catch(c){return d.logger.error("BetterChatGestures: Error in handleTapUsername patch",c),l.apply(a,n)}});this.patches.push(s)}if(a.handleTapMessage){const s=A.after("handleTapMessage",a,function(n){try{if(!n?.[0])return;const{nativeEvent:l}=n[0];if(!l)return;const c=l.channelId,i=l.messageId;if(!c||!i)return;const u=W?.getChannel(c),o=O?.getMessage(c,i);if(!o)return;r.currentMessageID===i?r.currentTapIndex++:(r.resetTapState(),r.currentTapIndex=1,r.currentMessageID=i);let p=1e3;if(t.storage.delay){const k=parseInt(t.storage.delay,10);!isNaN(k)&&k>=200&&(p=k)}r.timeoutTap&&clearTimeout(r.timeoutTap),r.timeoutTap=setTimeout(function(){r.resetTapState()},p);const g=G?.getCurrentUser(),m=g&&o.author?o.author.id===g.id:!1,H={...l,taps:r.currentTapIndex,content:o.content||"",authorId:o.author?.id,isAuthor:m};if(r.currentTapIndex!==2){r.doubleTapState({state:"INCOMPLETE",nativeEvent:H});return}const oe=r.currentMessageID;r.resetTapState(),m?t.storage.userEdit?j?.startEditMessage(c,oe,H.content):t.storage.reply&&u&&F?.createPendingReply({channel:u,message:o,shouldMention:!0}):t.storage.reply&&u&&F?.createPendingReply({channel:u,message:o,shouldMention:!0}),r.openKeyboard(),r.doubleTapState({state:"COMPLETE",nativeEvent:H})}catch(l){d.logger.error("BetterChatGestures: Error in handleTapMessage patch",l),r.resetTapState()}});this.patches.push(s)}this.unpatchHandlers=function(){try{r.patches.forEach(function(s){typeof s=="function"&&s()}),r.patches=[],r.handlersInstances=new WeakSet}catch(s){d.logger.error("BetterChatGestures: Error in unpatchHandlers",s)}}}catch(s){d.logger.error("BetterChatGestures: Error in patchHandlers",s)}}},onLoad(){var a,r,s,n,l,c;try{if(!P){d.logger.error("BetterChatGestures: MessagesHandlers module not found! Plugin will not work.");return}(a=t.storage).tapUsernameMention??(a.tapUsernameMention=e.ReactNative.Platform.select({android:!1,ios:!0,default:!0})),e.ReactNative.Platform.OS==="android"&&(t.storage.tapUsernameMention=!1),(r=t.storage).reply??(r.reply=!0),(s=t.storage).userEdit??(s.userEdit=!0),(n=t.storage).keyboardPopup??(n.keyboardPopup=!1),(l=t.storage).delay??(l.delay="1000"),(c=t.storage).debugMode??(c.debugMode=!1),(!t.storage.delay||t.storage.delay===""||isNaN(parseInt(t.storage.delay,10))||parseInt(t.storage.delay,10)<200)&&(t.storage.delay="1000"),d.logger.log("BetterChatGestures: initialized with delay =",t.storage.delay);const i=this,u=["params","handlers","_params","messageHandlers"];let o=null,p=null;for(const g of u)if(o=Object.getOwnPropertyDescriptor(P.prototype,g)?.get,o){p=g,d.logger.log(`BetterChatGestures: Found property '${g}'`);break}if(o&&p){let g=!0;Object.defineProperty(P.prototype,p,{configurable:!0,get(){const m=o.call(this);return this&&g?(g=!1,i.patchHandlers.call(i,m),d.logger.log("BetterChatGestures: Patched handlers on first access")):this&&i.patchHandlers.call(i,m),m}}),this.unpatchGetter=function(){try{o&&p&&Object.defineProperty(P.prototype,p,{configurable:!0,get:o})}catch(m){d.logger.error("BetterChatGestures: Error in unpatchGetter",m)}}}else d.logger.error("BetterChatGestures: Could not find params getter!")}catch(i){d.logger.error("BetterChatGestures: Error in onLoad",i)}},onUnload(){try{this.resetTapState(),this.unpatchGetter&&this.unpatchGetter(),this.unpatchHandlers&&this.unpatchHandlers(),this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null)}catch(a){d.logger.error("BetterChatGestures: Error in onUnload",a)}},settings:se};return w.default=ne,Object.defineProperty(w,"__esModule",{value:!0}),w})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.components,vendetta.storage,vendetta.ui.assets,vendetta.ui,vendetta);
