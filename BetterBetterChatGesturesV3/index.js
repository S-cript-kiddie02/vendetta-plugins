var plugin=(()=>{var H=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var ce=Object.prototype.hasOwnProperty;var l=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var he=(e,t)=>{for(var r in t)H(e,r,{get:t[r],enumerable:!0})},me=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of de(t))!ce.call(e,s)&&s!==r&&H(e,s,{get:()=>t[s],enumerable:!(a=ue(t,s))||a.enumerable});return e};var fe=e=>me(H({},"__esModule",{value:!0}),e);var De={};he(De,{default:()=>xe});var T=l("@vendetta/metro"),A=l("@vendetta/metro/common"),L=l("@vendetta/patcher"),i=l("@vendetta/plugin");var o=l("@vendetta/metro/common"),I=l("@vendetta/plugin"),_=l("@vendetta/ui/components"),n=l("@vendetta/plugin"),ne=l("@vendetta/storage");var u=l("@vendetta/metro/common"),P=l("@vendetta/metro"),ee=l("@vendetta/ui/components");var J=l("@vendetta/metro/common");var d=l("@vendetta/ui/assets"),f={Failed:(0,d.getAssetIDByName)("Small"),Delete:(0,d.getAssetIDByName)("ic_message_delete"),Copy:(0,d.getAssetIDByName)("toast_copy_link"),Open:(0,d.getAssetIDByName)("ic_leave_stage"),Clipboard:(0,d.getAssetIDByName)("pending-alert"),Clock:(0,d.getAssetIDByName)("clock"),Forum:(0,d.getAssetIDByName)("ic_forum_channel"),Settings:{Toasts:{Settings:(0,d.getAssetIDByName)("ic_selection_checked_24px"),Failed:(0,d.getAssetIDByName)("ic_close_circle_24px")},Initial:(0,d.getAssetIDByName)("coffee"),Update:(0,d.getAssetIDByName)("discover"),Locale:(0,d.getAssetIDByName)("ic_locale_24px"),External:(0,d.getAssetIDByName)("ic_raised_hand_list"),Edit:(0,d.getAssetIDByName)("ic_edit_24px"),Reply:(0,d.getAssetIDByName)("ic_reply_24px"),Keyboard:(0,d.getAssetIDByName)("ic_keyboard_24px")}};var ye=(e=.1)=>({shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:e,shadowRadius:4.65,elevation:8}),ge=(e,t)=>{J.toasts.open({content:t=="clipboard"?`Copied ${e} to clipboard.`:e,source:t=="clipboard"?f.Clipboard:f.Settings.Initial})},y={shadow:ye,displayToast:ge};var E={plugin:{source:"https://github.com/MYSTRAVIL/vendetta-plugins"},author:{profile:{"Rosie<3":"https://github.com/acquitelol"}}};var Y=l("@vendetta/ui"),{TouchableOpacity:V,View:K,Image:be,Text:$,Animated:O}=ee.General,Q=(0,P.findByProps)("transitionToGuild"),Z=(0,P.findByStoreName)("UserStore"),Te=(0,P.findByProps)("showUserProfile"),S=u.stylesheet.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...y.shadow()},image:{width:75,height:75,borderRadius:10,...y.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:Y.semanticColors.HEADER_PRIMARY,fontFamily:u.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:Y.semanticColors.HEADER_SECONDARY,fontSize:12.75}}),te=({name:e,authors:t})=>{let r=u.React.useRef(new O.Value(1)).current,a=()=>O.spring(r,{toValue:1.1,duration:10,useNativeDriver:!0}).start(),s=()=>O.spring(r,{toValue:1,duration:250,useNativeDriver:!0}).start(),c=()=>Te.showUserProfile({userId:Z.getCurrentUser().id}),h={transform:[{scale:r}]};return u.React.createElement(u.React.Fragment,null,u.React.createElement(K,{style:S.container},u.React.createElement(V,{onPress:c,onPressIn:a,onPressOut:s},u.React.createElement(O.View,{style:h},u.React.createElement(be,{style:[S.image],source:{uri:Z?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),u.React.createElement(K,{style:S.textContainer},u.React.createElement(V,{onPress:()=>Q.openURL(E.plugin.source)},u.React.createElement($,{style:[S.mainText,S.header]},e)),u.React.createElement(K,{style:{flexDirection:"row"}},u.React.createElement($,{style:[S.mainText,S.subHeader]},"A project by"),t.map((m,b,M)=>u.React.createElement(V,{onPress:()=>Q.openURL(E.author.profile[m.name]??"https://github.com/")},u.React.createElement($,{style:[S.mainText,S.subHeader,{paddingLeft:4,fontFamily:u.constants.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},m.name,b<M.length-1?",":null)))))))};var oe=l("@vendetta/ui/components"),w=l("@vendetta/metro/common"),se=l("@vendetta/ui"),{View:Se,Text:Ce}=oe.General,re=w.stylesheet.createThemedStyleSheet({text:{color:se.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:w.constants.Fonts.PRIMARY_BOLD,fontSize:12}}),j=({label:e,children:t})=>w.React.createElement(Se,{style:{marginTop:10}},w.React.createElement(Ce,{style:[re.text,re.optionText]},e.toUpperCase()),t);var D=l("@vendetta/ui"),v=l("@vendetta/metro/common"),{FormRow:g,FormSwitch:B,FormDivider:x,FormInput:Me,FormText:we}=_.Forms,{ScrollView:Ee,View:W,Text:Ie}=_.General,C=o.stylesheet.createThemedStyleSheet({icon:{color:D.semanticColors.INTERACTIVE_NORMAL},item:{color:D.semanticColors.TEXT_MUTED,fontFamily:o.constants.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:D.semanticColors.BACKGROUND_MOBILE_SECONDARY,...y.shadow()},subheaderText:{color:D.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:o.constants.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}}),ae=()=>{n.storage.tapUsernameMention===void 0&&(n.storage.tapUsernameMention=!1),n.storage.reply===void 0&&(n.storage.reply=!0),n.storage.userEdit===void 0&&(n.storage.userEdit=!0),n.storage.keyboardPopup===void 0&&(n.storage.keyboardPopup=!0),n.storage.delay===void 0&&(n.storage.delay="1000"),(0,ne.useProxy)(n.storage);let e=v.ReactNative.Platform.OS==="android",t=a=>{/^\d*$/.test(a)&&(n.storage.delay=a)},r=()=>{try{v.ReactNative.Linking&&v.ReactNative.Linking.openURL?v.ReactNative.Linking.openURL(E.plugin.source):y.displayToast("Cannot open URL: Linking not available","error")}catch(a){y.displayToast("Error opening URL","error"),console.error("Error opening URL:",a)}};return o.React.createElement(Ee,null,o.React.createElement(te,{name:I.manifest.name,authors:I.manifest.authors}),o.React.createElement(W,{style:{marginTop:20}},o.React.createElement(j,{label:"Preferences"},o.React.createElement(W,{style:[C.container]},o.React.createElement(g,{label:"Tap Username to Mention",subLabel:`Allows you to tap on a username to mention them instead of opening their profile.${e?" This option is disabled on Android.":""}`,onLongPress:()=>y.displayToast("By default, Discord opens a profile when tapping on a username in chat. With this, it now mentions them, like on Android.","tooltip"),leading:o.React.createElement(g.Icon,{style:C.icon,source:n.storage.tapUsernameMention?f.Forum:f.Failed}),trailing:o.React.createElement(B,{value:e?!1:n.storage.tapUsernameMention,onValueChange:()=>{e||(n.storage.tapUsernameMention=!n.storage.tapUsernameMention)}}),disabled:e}),o.React.createElement(x,null),o.React.createElement(g,{label:"Double Tap To Reply",subLabel:"Allows you to double tap on any messages to reply to them.",onLongPress:()=>y.displayToast("Double tapping anyones message allows you to reply to them!","tooltip"),leading:o.React.createElement(g.Icon,{style:C.icon,source:n.storage.reply?f.Settings.Reply:f.Failed}),trailing:o.React.createElement(B,{value:n.storage.reply,onValueChange:()=>{n.storage.reply=!n.storage.reply}})}),o.React.createElement(x,null),o.React.createElement(g,{label:"Open Keyboard Automatically",subLabel:"Opens the Keyboard when you reply to or edit a message with a double tap.",onLongPress:()=>y.displayToast("Opens the Keyboard when you reply to or edit a message with a double tap.","tooltip"),leading:o.React.createElement(g.Icon,{style:C.icon,source:n.storage.keyboardPopup?f.Settings.Keyboard:f.Failed}),trailing:o.React.createElement(B,{value:n.storage.keyboardPopup,onValueChange:()=>{n.storage.keyboardPopup=!n.storage.keyboardPopup}})}),o.React.createElement(x,null),o.React.createElement(g,{label:`${n.storage.userEdit?"Double tap to edit":"Double tap to reply to"} your own messages`,subLabel:`Allows you to double tap on any of your own messages to ${n.storage.userEdit?"edit":"reply to"} them.`,onLongPress:()=>y.displayToast(`When double tapping on any of your own messages, you can now ${n.storage.userEdit?"edit them":"reply to them"}!`,"tooltip"),leading:o.React.createElement(g.Icon,{style:C.icon,source:n.storage.userEdit?f.Settings.Edit:f.Settings.Reply}),trailing:o.React.createElement(B,{value:n.storage.userEdit,onValueChange:()=>{n.storage.userEdit=!n.storage.userEdit}})}),o.React.createElement(x,null),o.React.createElement(Me,{value:n.storage.delay,onChange:t,placeholder:"1000",title:"Maximum Delay",keyboardType:"numeric"}),o.React.createElement(x,null),o.React.createElement(we,{style:{padding:10}},"The maximum delay between taps until the double tap event is cancelled. This is 300ms by default."))),o.React.createElement(j,{label:"Source"},o.React.createElement(W,{style:C.container},o.React.createElement(g,{label:"Source",subLabel:`Open the repository of ${I.manifest.name} externally.`,onLongPress:()=>y.displayToast(`Opens the repository of ${I.manifest.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip"),leading:o.React.createElement(g.Icon,{style:C.icon,source:f.Open}),trailing:()=>o.React.createElement(g.Arrow,null),onPress:r})))),o.React.createElement(Ie,{style:C.subheaderText},`Build: (${I.manifest.hash?.substring(0,8)||"dev"}`))};var p=l("@vendetta"),R=(0,T.findByProps)("insertText"),ie=(0,T.findByStoreName)("ChannelStore"),z=(0,T.findByStoreName)("MessageStore"),q=(0,T.findByStoreName)("UserStore"),le=(0,T.findByProps)("sendMessage","startEditMessage"),X=(0,T.findByProps)("createPendingReply"),G;try{G=(0,T.findByProps)("MessagesHandlers")}catch{p.logger.warn("BetterChatGestures: Could not find MessagesHandlers via findByProps")}if(!G)try{let e=window.vendetta?.metro?.cache||new Map;for(let[t,r]of e)if(r?.exports?.MessagesHandlers){G=r.exports,p.logger.log("BetterChatGestures: Found MessagesHandlers via cache iteration");break}}catch(e){p.logger.error("BetterChatGestures: Failed to find MessagesHandlers via cache",e)}var U=G?.MessagesHandlers,Pe={unpatchGetter:null,unpatchHandlers:null,currentTapIndex:0,currentMessageID:null,timeoutTap:null,patches:[],handlersInstances:new WeakSet,doubleTapState({state:e="UNKNOWN",nativeEvent:t}){try{let r={state:e,data:t};e==="INCOMPLETE"&&t&&Object.assign(r,{reason:{required:{taps:2,isAuthor:!0},received:{taps:t.taps,isAuthor:t.isAuthor}}});let a=q?.getCurrentUser();a&&i.manifest.authors.find(s=>s.id===a.id)&&console.log("DoubleTapState",r)}catch(r){p.logger.error("BetterChatGestures: Error in doubleTapState",r)}},resetTapState(){try{this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null),this.currentTapIndex=0,this.currentMessageID=null}catch(e){p.logger.error("BetterChatGestures: Error in resetTapState",e)}},openKeyboard(){if(i.storage.keyboardPopup)try{let e=(0,T.findByProps)("openSystemKeyboard");if(e?.openSystemKeyboard){e.openSystemKeyboard();return}if(e?.openSystemKeyboardForLastCreatedInput){e.openSystemKeyboardForLastCreatedInput();return}let t=R?.refs?.[0]?.current;if(t?.focus){t.focus();return}A.ReactNative.Keyboard?.dismiss&&setTimeout(()=>{t?.focus&&t.focus()},50)}catch(e){i.storage.debugMode&&p.logger.error("BetterChatGestures: Error opening keyboard",e)}},patchHandlers(e){if(!this.handlersInstances.has(e)){this.handlersInstances.add(e);try{if(e.handleDoubleTapMessage){let t=(0,L.instead)("handleDoubleTapMessage",e,(r,a)=>{try{if(!r?.[0]?.nativeEvent)return;let{nativeEvent:s}=r[0],c=s.channelId,h=s.messageId;if(!c||!h)return;let m=ie?.getChannel(c),b=z?.getMessage(c,h);if(!b)return;let M=q?.getCurrentUser();(M&&b.author?b.author.id===M.id:!1)&&i.storage.userEdit?le?.startEditMessage(c,h,b.content||""):i.storage.reply&&m&&X?.createPendingReply({channel:m,message:b,shouldMention:!0}),this.openKeyboard();return}catch(s){p.logger.error("BetterChatGestures: Error in handleDoubleTapMessage patch",s)}});this.patches.push(t)}if(e.handleTapUsername&&i.storage.tapUsernameMention){let t=(0,L.instead)("handleTapUsername",e,(r,a)=>{try{if(!i.storage.tapUsernameMention||!r?.[0]?.nativeEvent)return a.apply(e,r);let s=R?.refs?.[0]?.current,{messageId:c}=r[0].nativeEvent;if(!s?.props?.channel?.id)return a.apply(e,r);let h=z.getMessage(s.props.channel.id,c);if(!h?.author)return a.apply(e,r);let m=h.author.discriminator!=="0"?`#${h.author.discriminator}`:"";R.insertText(`@${h.author.username}${m}`)}catch(s){return p.logger.error("BetterChatGestures: Error in handleTapUsername patch",s),a.apply(e,r)}});this.patches.push(t)}if(e.handleTapMessage){let t=(0,L.after)("handleTapMessage",e,r=>{try{if(!r?.[0])return;let{nativeEvent:a}=r[0];if(!a)return;let s=a.channelId,c=a.messageId;if(!s||!c)return;let h=ie?.getChannel(s),m=z?.getMessage(s,c);if(!m)return;this.currentMessageID===c?this.currentTapIndex++:(this.resetTapState(),this.currentTapIndex=1,this.currentMessageID=c);let b=1e3;if(i.storage.delay){let F=parseInt(i.storage.delay,10);!isNaN(F)&&F>=200&&(b=F)}this.timeoutTap&&clearTimeout(this.timeoutTap),this.timeoutTap=setTimeout(()=>{this.resetTapState()},b);let M=q?.getCurrentUser(),N=M&&m.author?m.author.id===M.id:!1,k={...a,taps:this.currentTapIndex,content:m.content||"",authorId:m.author?.id,isAuthor:N};if(this.currentTapIndex!==2){this.doubleTapState({state:"INCOMPLETE",nativeEvent:k});return}let pe=this.currentMessageID;this.resetTapState(),N?i.storage.userEdit?le?.startEditMessage(s,pe,k.content):i.storage.reply&&h&&X?.createPendingReply({channel:h,message:m,shouldMention:!0}):i.storage.reply&&h&&X?.createPendingReply({channel:h,message:m,shouldMention:!0}),this.openKeyboard(),this.doubleTapState({state:"COMPLETE",nativeEvent:k})}catch(a){p.logger.error("BetterChatGestures: Error in handleTapMessage patch",a),this.resetTapState()}});this.patches.push(t)}this.unpatchHandlers=()=>{try{this.patches.forEach(t=>{typeof t=="function"&&t()}),this.patches=[],this.handlersInstances=new WeakSet}catch(t){p.logger.error("BetterChatGestures: Error in unpatchHandlers",t)}}}catch(t){p.logger.error("BetterChatGestures: Error in patchHandlers",t)}}},onLoad(){try{if(!U){p.logger.error("BetterChatGestures: MessagesHandlers module not found! Plugin will not work.");return}i.storage.tapUsernameMention??=A.ReactNative.Platform.select({android:!1,ios:!0,default:!0}),A.ReactNative.Platform.OS==="android"&&(i.storage.tapUsernameMention=!1),i.storage.reply??=!0,i.storage.userEdit??=!0,i.storage.keyboardPopup??=!0,i.storage.delay??="1000",i.storage.debugMode??=!1,(!i.storage.delay||i.storage.delay===""||isNaN(parseInt(i.storage.delay,10))||parseInt(i.storage.delay,10)<200)&&(i.storage.delay="1000"),p.logger.log("BetterChatGestures: initialized with delay =",i.storage.delay);let e=this,t=["params","handlers","_params","messageHandlers"],r=null,a=null;for(let s of t)if(r=Object.getOwnPropertyDescriptor(U.prototype,s)?.get,r){a=s,p.logger.log(`BetterChatGestures: Found property '${s}'`);break}if(r&&a){try{let s=Object.create(U.prototype),c=r.call(s);c&&(e.patchHandlers.call(e,c),p.logger.log("BetterChatGestures: Proactively patched handlers on load"))}catch(s){p.logger.warn("BetterChatGestures: Could not proactively patch, will patch on first access",s)}Object.defineProperty(U.prototype,a,{configurable:!0,get(){return this&&e.patchHandlers.call(e,this),r.call(this)}}),this.unpatchGetter=()=>{try{r&&a&&Object.defineProperty(U.prototype,a,{configurable:!0,get:r})}catch(s){p.logger.error("BetterChatGestures: Error in unpatchGetter",s)}}}else p.logger.error("BetterChatGestures: Could not find params getter!")}catch(e){p.logger.error("BetterChatGestures: Error in onLoad",e)}},onUnload(){try{this.resetTapState(),this.unpatchGetter&&this.unpatchGetter(),this.unpatchHandlers&&this.unpatchHandlers(),this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null)}catch(e){p.logger.error("BetterChatGestures: Error in onUnload",e)}},settings:ae},xe=Pe;return fe(De);})();
