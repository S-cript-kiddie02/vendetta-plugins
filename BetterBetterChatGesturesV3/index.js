import{findByProps as I,findByStoreName as Y}from"@vendetta/metro";import{ReactNative as F}from"@vendetta/metro/common";import{after as xe,instead as te}from"@vendetta/patcher";import{storage as i,manifest as De}from"@vendetta/plugin";import{stylesheet as Te,constants as Z,React as s}from"@vendetta/metro/common";import{manifest as M}from"@vendetta/plugin";import{General as Se,Forms as Ce}from"@vendetta/ui/components";import{storage as o}from"@vendetta/plugin";import{useProxy as Me}from"@vendetta/storage";import{React as m,constants as z,stylesheet as le}from"@vendetta/metro/common";import{findByProps as q,findByStoreName as pe}from"@vendetta/metro";import{General as ue}from"@vendetta/ui/components";import{toasts as ne}from"@vendetta/metro/common";import{getAssetIDByName as u}from"@vendetta/ui/assets";var h={Failed:u("Small"),Delete:u("ic_message_delete"),Copy:u("toast_copy_link"),Open:u("ic_leave_stage"),Clipboard:u("pending-alert"),Clock:u("clock"),Forum:u("ic_forum_channel"),Settings:{Toasts:{Settings:u("ic_selection_checked_24px"),Failed:u("ic_close_circle_24px")},Initial:u("coffee"),Update:u("discover"),Locale:u("ic_locale_24px"),External:u("ic_raised_hand_list"),Edit:u("ic_edit_24px"),Reply:u("ic_reply_24px"),Keyboard:u("ic_keyboard_24px")}};var ae=(e=.1)=>({shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:e,shadowRadius:4.65,elevation:8}),ie=(e,r)=>{ne.open({content:r=="clipboard"?`Copied ${e} to clipboard.`:e,source:r=="clipboard"?h.Clipboard:h.Settings.Initial})},f={shadow:ae,displayToast:ie};var C={plugin:{source:"https://github.com/MYSTRAVIL/vendetta-plugins"},author:{profile:{"Rosie<3":"https://github.com/acquitelol"}}};import{semanticColors as j}from"@vendetta/ui";var{TouchableOpacity:_,View:A,Image:de,Text:G,Animated:P}=ue,W=q("transitionToGuild"),R=pe("UserStore"),ce=q("showUserProfile"),b=le.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...f.shadow()},image:{width:75,height:75,borderRadius:10,...f.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:j.HEADER_PRIMARY,fontFamily:z.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:j.HEADER_SECONDARY,fontSize:12.75}}),X=({name:e,authors:r})=>{let t=m.useRef(new P.Value(1)).current,n=()=>P.spring(t,{toValue:1.1,duration:10,useNativeDriver:!0}).start(),a=()=>P.spring(t,{toValue:1,duration:250,useNativeDriver:!0}).start(),p=()=>ce.showUserProfile({userId:R.getCurrentUser().id}),d={transform:[{scale:t}]};return m.createElement(m.Fragment,null,m.createElement(A,{style:b.container},m.createElement(_,{onPress:p,onPressIn:n,onPressOut:a},m.createElement(P.View,{style:d},m.createElement(de,{style:[b.image],source:{uri:R?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),m.createElement(A,{style:b.textContainer},m.createElement(_,{onPress:()=>W.openURL(C.plugin.source)},m.createElement(G,{style:[b.mainText,b.header]},e)),m.createElement(A,{style:{flexDirection:"row"}},m.createElement(G,{style:[b.mainText,b.subHeader]},"A project by"),r.map((c,g,S)=>m.createElement(_,{onPress:()=>W.openURL(C.author.profile[c.name]??"https://github.com/")},m.createElement(G,{style:[b.mainText,b.subHeader,{paddingLeft:4,fontFamily:z.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},c.name,g<S.length-1?",":null)))))))};import{General as he}from"@vendetta/ui/components";import{constants as me,React as J,stylesheet as fe}from"@vendetta/metro/common";import{semanticColors as ye}from"@vendetta/ui";var{View:ge,Text:be}=he,Q=fe.createThemedStyleSheet({text:{color:ye.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:me.Fonts.PRIMARY_BOLD,fontSize:12}}),N=({label:e,children:r})=>J.createElement(ge,{style:{marginTop:10}},J.createElement(be,{style:[Q.text,Q.optionText]},e.toUpperCase()),r);import{semanticColors as x}from"@vendetta/ui";import{ReactNative as D}from"@vendetta/metro/common";var{FormRow:y,FormSwitch:v,FormDivider:w,FormInput:we,FormText:Ee}=Ce,{ScrollView:Ie,View:k,Text:Pe}=Se,T=Te.createThemedStyleSheet({icon:{color:x.INTERACTIVE_NORMAL},item:{color:x.TEXT_MUTED,fontFamily:Z.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:x.BACKGROUND_MOBILE_SECONDARY,...f.shadow()},subheaderText:{color:x.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:Z.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}}),ee=()=>{o.tapUsernameMention===void 0&&(o.tapUsernameMention=!1),o.reply===void 0&&(o.reply=!0),o.userEdit===void 0&&(o.userEdit=!0),o.keyboardPopup===void 0&&(o.keyboardPopup=!0),o.delay===void 0&&(o.delay="1000"),Me(o);let e=D.Platform.OS==="android",r=n=>{/^\d*$/.test(n)&&(o.delay=n)},t=()=>{try{D.Linking&&D.Linking.openURL?D.Linking.openURL(C.plugin.source):f.displayToast("Cannot open URL: Linking not available","error")}catch(n){f.displayToast("Error opening URL","error"),console.error("Error opening URL:",n)}};return s.createElement(Ie,null,s.createElement(X,{name:M.name,authors:M.authors}),s.createElement(k,{style:{marginTop:20}},s.createElement(N,{label:"Preferences"},s.createElement(k,{style:[T.container]},s.createElement(y,{label:"Tap Username to Mention",subLabel:`Allows you to tap on a username to mention them instead of opening their profile.${e?" This option is disabled on Android.":""}`,onLongPress:()=>f.displayToast("By default, Discord opens a profile when tapping on a username in chat. With this, it now mentions them, like on Android.","tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:o.tapUsernameMention?h.Forum:h.Failed}),trailing:s.createElement(v,{value:e?!1:o.tapUsernameMention,onValueChange:()=>{e||(o.tapUsernameMention=!o.tapUsernameMention)}}),disabled:e}),s.createElement(w,null),s.createElement(y,{label:"Double Tap To Reply",subLabel:"Allows you to double tap on any messages to reply to them.",onLongPress:()=>f.displayToast("Double tapping anyones message allows you to reply to them!","tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:o.reply?h.Settings.Reply:h.Failed}),trailing:s.createElement(v,{value:o.reply,onValueChange:()=>{o.reply=!o.reply}})}),s.createElement(w,null),s.createElement(y,{label:"Open Keyboard Automatically",subLabel:"Opens the Keyboard when you reply to or edit a message with a double tap.",onLongPress:()=>f.displayToast("Opens the Keyboard when you reply to or edit a message with a double tap.","tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:o.keyboardPopup?h.Settings.Keyboard:h.Failed}),trailing:s.createElement(v,{value:o.keyboardPopup,onValueChange:()=>{o.keyboardPopup=!o.keyboardPopup}})}),s.createElement(w,null),s.createElement(y,{label:`${o.userEdit?"Double tap to edit":"Double tap to reply to"} your own messages`,subLabel:`Allows you to double tap on any of your own messages to ${o.userEdit?"edit":"reply to"} them.`,onLongPress:()=>f.displayToast(`When double tapping on any of your own messages, you can now ${o.userEdit?"edit them":"reply to them"}!`,"tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:o.userEdit?h.Settings.Edit:h.Settings.Reply}),trailing:s.createElement(v,{value:o.userEdit,onValueChange:()=>{o.userEdit=!o.userEdit}})}),s.createElement(w,null),s.createElement(we,{value:o.delay,onChange:r,placeholder:"1000",title:"Maximum Delay",keyboardType:"numeric"}),s.createElement(w,null),s.createElement(Ee,{style:{padding:10}},"The maximum delay between taps until the double tap event is cancelled. This is 300ms by default."))),s.createElement(N,{label:"Source"},s.createElement(k,{style:T.container},s.createElement(y,{label:"Source",subLabel:`Open the repository of ${M.name} externally.`,onLongPress:()=>f.displayToast(`Opens the repository of ${M.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:h.Open}),trailing:()=>s.createElement(y.Arrow,null),onPress:t})))),s.createElement(Pe,{style:T.subheaderText},`Build: (${M.hash?.substring(0,8)||"dev"}`))};import{logger as l}from"@vendetta";var H=I("insertText"),re=Y("ChannelStore"),V=Y("MessageStore"),K=Y("UserStore"),oe=I("sendMessage","startEditMessage"),$=I("createPendingReply"),U;try{U=I("MessagesHandlers")}catch{l.warn("BetterChatGestures: Could not find MessagesHandlers via findByProps")}if(!U)try{let e=window.vendetta?.metro?.cache||new Map;for(let[r,t]of e)if(t?.exports?.MessagesHandlers){U=t.exports,l.log("BetterChatGestures: Found MessagesHandlers via cache iteration");break}}catch(e){l.error("BetterChatGestures: Failed to find MessagesHandlers via cache",e)}var E=U?.MessagesHandlers,ve={unpatchGetter:null,unpatchHandlers:null,currentTapIndex:0,currentMessageID:null,timeoutTap:null,patches:[],handlersInstances:new WeakSet,doubleTapState({state:e="UNKNOWN",nativeEvent:r}){try{let t={state:e,data:r};e==="INCOMPLETE"&&r&&Object.assign(t,{reason:{required:{taps:2,isAuthor:!0},received:{taps:r.taps,isAuthor:r.isAuthor}}});let n=K?.getCurrentUser();n&&De.authors.find(a=>a.id===n.id)&&console.log("DoubleTapState",t)}catch(t){l.error("BetterChatGestures: Error in doubleTapState",t)}},resetTapState(){try{this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null),this.currentTapIndex=0,this.currentMessageID=null}catch(e){l.error("BetterChatGestures: Error in resetTapState",e)}},openKeyboard(){if(i.keyboardPopup)try{let e=I("openSystemKeyboard");if(e?.openSystemKeyboard){e.openSystemKeyboard();return}if(e?.openSystemKeyboardForLastCreatedInput){e.openSystemKeyboardForLastCreatedInput();return}let r=H?.refs?.[0]?.current;if(r?.focus){r.focus();return}F.Keyboard?.dismiss&&setTimeout(()=>{r?.focus&&r.focus()},50)}catch(e){i.debugMode&&l.error("BetterChatGestures: Error opening keyboard",e)}},patchHandlers(e){if(!this.handlersInstances.has(e)){this.handlersInstances.add(e);try{if(e.handleDoubleTapMessage){let r=te("handleDoubleTapMessage",e,(t,n)=>{try{if(!t?.[0]?.nativeEvent)return;let{nativeEvent:a}=t[0],p=a.channelId,d=a.messageId;if(!p||!d)return;let c=re?.getChannel(p),g=V?.getMessage(p,d);if(!g)return;let S=K?.getCurrentUser();(S&&g.author?g.author.id===S.id:!1)&&i.userEdit?oe?.startEditMessage(p,d,g.content||""):i.reply&&c&&$?.createPendingReply({channel:c,message:g,shouldMention:!0}),this.openKeyboard();return}catch(a){l.error("BetterChatGestures: Error in handleDoubleTapMessage patch",a)}});this.patches.push(r)}if(e.handleTapUsername&&i.tapUsernameMention){let r=te("handleTapUsername",e,(t,n)=>{try{if(!i.tapUsernameMention||!t?.[0]?.nativeEvent)return n.apply(e,t);let a=H?.refs?.[0]?.current,{messageId:p}=t[0].nativeEvent;if(!a?.props?.channel?.id)return n.apply(e,t);let d=V.getMessage(a.props.channel.id,p);if(!d?.author)return n.apply(e,t);let c=d.author.discriminator!=="0"?`#${d.author.discriminator}`:"";H.insertText(`@${d.author.username}${c}`)}catch(a){return l.error("BetterChatGestures: Error in handleTapUsername patch",a),n.apply(e,t)}});this.patches.push(r)}if(e.handleTapMessage){let r=xe("handleTapMessage",e,t=>{try{if(!t?.[0])return;let{nativeEvent:n}=t[0];if(!n)return;let a=n.channelId,p=n.messageId;if(!a||!p)return;let d=re?.getChannel(a),c=V?.getMessage(a,p);if(!c)return;this.currentMessageID===p?this.currentTapIndex++:(this.resetTapState(),this.currentTapIndex=1,this.currentMessageID=p);let g=1e3;if(i.delay){let B=parseInt(i.delay,10);!isNaN(B)&&B>=200&&(g=B)}this.timeoutTap&&clearTimeout(this.timeoutTap),this.timeoutTap=setTimeout(()=>{this.resetTapState()},g);let S=K?.getCurrentUser(),L=S&&c.author?c.author.id===S.id:!1,O={...n,taps:this.currentTapIndex,content:c.content||"",authorId:c.author?.id,isAuthor:L};if(this.currentTapIndex!==2){this.doubleTapState({state:"INCOMPLETE",nativeEvent:O});return}let se=this.currentMessageID;this.resetTapState(),L?i.userEdit?oe?.startEditMessage(a,se,O.content):i.reply&&d&&$?.createPendingReply({channel:d,message:c,shouldMention:!0}):i.reply&&d&&$?.createPendingReply({channel:d,message:c,shouldMention:!0}),this.openKeyboard(),this.doubleTapState({state:"COMPLETE",nativeEvent:O})}catch(n){l.error("BetterChatGestures: Error in handleTapMessage patch",n),this.resetTapState()}});this.patches.push(r)}this.unpatchHandlers=()=>{try{this.patches.forEach(r=>{typeof r=="function"&&r()}),this.patches=[],this.handlersInstances=new WeakSet}catch(r){l.error("BetterChatGestures: Error in unpatchHandlers",r)}}}catch(r){l.error("BetterChatGestures: Error in patchHandlers",r)}}},onLoad(){try{if(!E){l.error("BetterChatGestures: MessagesHandlers module not found! Plugin will not work.");return}i.tapUsernameMention??=F.Platform.select({android:!1,ios:!0,default:!0}),F.Platform.OS==="android"&&(i.tapUsernameMention=!1),i.reply??=!0,i.userEdit??=!0,i.keyboardPopup??=!0,i.delay??="1000",i.debugMode??=!1,(!i.delay||i.delay===""||isNaN(parseInt(i.delay,10))||parseInt(i.delay,10)<200)&&(i.delay="1000"),l.log("BetterChatGestures: initialized with delay =",i.delay);let e=this,r=["params","handlers","_params","messageHandlers"],t=null,n=null;for(let a of r)if(t=Object.getOwnPropertyDescriptor(E.prototype,a)?.get,t){n=a,l.log(`BetterChatGestures: Found property '${a}'`);break}if(t&&n){try{let a=Object.create(E.prototype),p=t.call(a);p&&(e.patchHandlers.call(e,p),l.log("BetterChatGestures: Proactively patched handlers on load"))}catch(a){l.warn("BetterChatGestures: Could not proactively patch, will patch on first access",a)}Object.defineProperty(E.prototype,n,{configurable:!0,get(){return this&&e.patchHandlers.call(e,this),t.call(this)}}),this.unpatchGetter=()=>{try{t&&n&&Object.defineProperty(E.prototype,n,{configurable:!0,get:t})}catch(a){l.error("BetterChatGestures: Error in unpatchGetter",a)}}}else l.error("BetterChatGestures: Could not find params getter!")}catch(e){l.error("BetterChatGestures: Error in onLoad",e)}},onUnload(){try{this.resetTapState(),this.unpatchGetter&&this.unpatchGetter(),this.unpatchHandlers&&this.unpatchHandlers(),this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null)}catch(e){l.error("BetterChatGestures: Error in onUnload",e)}},settings:ee},mt=ve;export{mt as default};
