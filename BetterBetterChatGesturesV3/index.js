import{findByProps as I,findByStoreName as Y}from"@vendetta/metro";import{ReactNative as F}from"@vendetta/metro/common";import{after as xe,instead as te}from"@vendetta/patcher";import{storage as i,manifest as De}from"@vendetta/plugin";import{stylesheet as Te,constants as Z,React as s}from"@vendetta/metro/common";import{manifest as C}from"@vendetta/plugin";import{General as Se,Forms as Me}from"@vendetta/ui/components";import{storage as o}from"@vendetta/plugin";import{useProxy as Ce}from"@vendetta/storage";import{React as h,constants as z,stylesheet as le}from"@vendetta/metro/common";import{findByProps as q,findByStoreName as pe}from"@vendetta/metro";import{General as ue}from"@vendetta/ui/components";import{toasts as ne}from"@vendetta/metro/common";import{getAssetIDByName as p}from"@vendetta/ui/assets";var c={Failed:p("Small"),Delete:p("ic_message_delete"),Copy:p("toast_copy_link"),Open:p("ic_leave_stage"),Clipboard:p("pending-alert"),Clock:p("clock"),Forum:p("ic_forum_channel"),Settings:{Toasts:{Settings:p("ic_selection_checked_24px"),Failed:p("ic_close_circle_24px")},Initial:p("coffee"),Update:p("discover"),Locale:p("ic_locale_24px"),External:p("ic_raised_hand_list"),Edit:p("ic_edit_24px"),Reply:p("ic_reply_24px"),Keyboard:p("ic_keyboard_24px")}};var ae=(e=.1)=>({shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:e,shadowRadius:4.65,elevation:8}),ie=(e,t)=>{ne.open({content:t=="clipboard"?`Copied ${e} to clipboard.`:e,source:t=="clipboard"?c.Clipboard:c.Settings.Initial})},f={shadow:ae,displayToast:ie};var M={plugin:{source:"https://github.com/MYSTRAVIL/vendetta-plugins"},author:{profile:{"Rosie<3":"https://github.com/acquitelol"}}};import{semanticColors as W}from"@vendetta/ui";var{TouchableOpacity:A,View:B,Image:de,Text:G,Animated:w}=ue,j=q("transitionToGuild"),R=pe("UserStore"),ce=q("showUserProfile"),b=le.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...f.shadow()},image:{width:75,height:75,borderRadius:10,...f.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:W.HEADER_PRIMARY,fontFamily:z.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:W.HEADER_SECONDARY,fontSize:12.75}}),X=({name:e,authors:t})=>{let r=h.useRef(new w.Value(1)).current,n=()=>w.spring(r,{toValue:1.1,duration:10,useNativeDriver:!0}).start(),a=()=>w.spring(r,{toValue:1,duration:250,useNativeDriver:!0}).start(),m=()=>ce.showUserProfile({userId:R.getCurrentUser().id}),u={transform:[{scale:r}]};return h.createElement(h.Fragment,null,h.createElement(B,{style:b.container},h.createElement(A,{onPress:m,onPressIn:n,onPressOut:a},h.createElement(w.View,{style:u},h.createElement(de,{style:[b.image],source:{uri:R?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),h.createElement(B,{style:b.textContainer},h.createElement(A,{onPress:()=>j.openURL(M.plugin.source)},h.createElement(G,{style:[b.mainText,b.header]},e)),h.createElement(B,{style:{flexDirection:"row"}},h.createElement(G,{style:[b.mainText,b.subHeader]},"A project by"),t.map((d,g,S)=>h.createElement(A,{onPress:()=>j.openURL(M.author.profile[d.name]??"https://github.com/")},h.createElement(G,{style:[b.mainText,b.subHeader,{paddingLeft:4,fontFamily:z.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},d.name,g<S.length-1?",":null)))))))};import{General as he}from"@vendetta/ui/components";import{constants as me,React as J,stylesheet as fe}from"@vendetta/metro/common";import{semanticColors as ye}from"@vendetta/ui";var{View:ge,Text:be}=he,Q=fe.createThemedStyleSheet({text:{color:ye.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:me.Fonts.PRIMARY_BOLD,fontSize:12}}),N=({label:e,children:t})=>J.createElement(ge,{style:{marginTop:10}},J.createElement(be,{style:[Q.text,Q.optionText]},e.toUpperCase()),t);import{semanticColors as P}from"@vendetta/ui";import{ReactNative as x}from"@vendetta/metro/common";var{FormRow:y,FormSwitch:D,FormDivider:E,FormInput:Ee,FormText:Ie}=Me,{ScrollView:we,View:k,Text:Pe}=Se,T=Te.createThemedStyleSheet({icon:{color:P.INTERACTIVE_NORMAL},item:{color:P.TEXT_MUTED,fontFamily:Z.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:P.BACKGROUND_MOBILE_SECONDARY,...f.shadow()},subheaderText:{color:P.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:Z.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}}),ee=()=>{o.tapUsernameMention===void 0&&(o.tapUsernameMention=!1),o.reply===void 0&&(o.reply=!0),o.userEdit===void 0&&(o.userEdit=!0),o.keyboardPopup===void 0&&(o.keyboardPopup=!0),o.delay===void 0&&(o.delay="1000"),Ce(o);let e=x.Platform.OS==="android",t=n=>{/^\d*$/.test(n)&&(o.delay=n)},r=()=>{try{x.Linking&&x.Linking.openURL?x.Linking.openURL(M.plugin.source):f.displayToast("Cannot open URL: Linking not available","error")}catch(n){f.displayToast("Error opening URL","error"),console.error("Error opening URL:",n)}};return s.createElement(we,null,s.createElement(X,{name:C.name,authors:C.authors}),s.createElement(k,{style:{marginTop:20}},s.createElement(N,{label:"Preferences"},s.createElement(k,{style:[T.container]},s.createElement(y,{label:"Tap Username to Mention",subLabel:`Allows you to tap on a username to mention them instead of opening their profile.${e?" This option is disabled on Android.":""}`,onLongPress:()=>f.displayToast("By default, Discord opens a profile when tapping on a username in chat. With this, it now mentions them, like on Android.","tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:o.tapUsernameMention?c.Forum:c.Failed}),trailing:s.createElement(D,{value:e?!1:o.tapUsernameMention,onValueChange:()=>{e||(o.tapUsernameMention=!o.tapUsernameMention)}}),disabled:e}),s.createElement(E,null),s.createElement(y,{label:"Double Tap To Reply",subLabel:"Allows you to double tap on any messages to reply to them.",onLongPress:()=>f.displayToast("Double tapping anyones message allows you to reply to them!","tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:o.reply?c.Settings.Reply:c.Failed}),trailing:s.createElement(D,{value:o.reply,onValueChange:()=>{o.reply=!o.reply}})}),s.createElement(E,null),s.createElement(y,{label:"Open Keyboard Automatically",subLabel:"Opens the Keyboard when you reply to or edit a message with a double tap.",onLongPress:()=>f.displayToast("Opens the Keyboard when you reply to or edit a message with a double tap.","tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:o.keyboardPopup?c.Settings.Keyboard:c.Failed}),trailing:s.createElement(D,{value:o.keyboardPopup,onValueChange:()=>{o.keyboardPopup=!o.keyboardPopup}})}),s.createElement(E,null),s.createElement(y,{label:`${o.userEdit?"Double tap to edit":"Double tap to reply to"} your own messages`,subLabel:`Allows you to double tap on any of your own messages to ${o.userEdit?"edit":"reply to"} them.`,onLongPress:()=>f.displayToast(`When double tapping on any of your own messages, you can now ${o.userEdit?"edit them":"reply to them"}!`,"tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:o.userEdit?c.Settings.Edit:c.Settings.Reply}),trailing:s.createElement(D,{value:o.userEdit,onValueChange:()=>{o.userEdit=!o.userEdit}})}),s.createElement(E,null),s.createElement(Ee,{value:o.delay,onChange:t,placeholder:"1000",title:"Maximum Delay",keyboardType:"numeric"}),s.createElement(E,null),s.createElement(Ie,{style:{padding:10}},"The maximum delay between taps until the double tap event is cancelled. This is 300ms by default."))),s.createElement(N,{label:"Source"},s.createElement(k,{style:T.container},s.createElement(y,{label:"Source",subLabel:`Open the repository of ${C.name} externally.`,onLongPress:()=>f.displayToast(`Opens the repository of ${C.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip"),leading:s.createElement(y.Icon,{style:T.icon,source:c.Open}),trailing:()=>s.createElement(y.Arrow,null),onPress:r})))),s.createElement(Pe,{style:T.subheaderText},`Build: (${C.hash?.substring(0,8)||"dev"}`))};import{logger as l}from"@vendetta";var H=I("insertText"),re=Y("ChannelStore"),V=Y("MessageStore"),K=Y("UserStore"),oe=I("sendMessage","startEditMessage"),$=I("createPendingReply"),U;try{U=I("MessagesHandlers")}catch{l.warn("BetterChatGestures: Could not find MessagesHandlers via findByProps")}if(!U)try{let e=window.vendetta?.metro?.cache||new Map;for(let[t,r]of e)if(r?.exports?.MessagesHandlers){U=r.exports,l.log("BetterChatGestures: Found MessagesHandlers via cache iteration");break}}catch(e){l.error("BetterChatGestures: Failed to find MessagesHandlers via cache",e)}var v=U?.MessagesHandlers,ve={unpatchGetter:null,unpatchHandlers:null,currentTapIndex:0,currentMessageID:null,timeoutTap:null,patches:[],handlersInstances:new WeakSet,doubleTapState({state:e="UNKNOWN",nativeEvent:t}){try{let r={state:e,data:t};e==="INCOMPLETE"&&t&&Object.assign(r,{reason:{required:{taps:2,isAuthor:!0},received:{taps:t.taps,isAuthor:t.isAuthor}}});let n=K?.getCurrentUser();n&&De.authors.find(a=>a.id===n.id)&&console.log("DoubleTapState",r)}catch(r){l.error("BetterChatGestures: Error in doubleTapState",r)}},resetTapState(){try{this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null),this.currentTapIndex=0,this.currentMessageID=null}catch(e){l.error("BetterChatGestures: Error in resetTapState",e)}},openKeyboard(){if(i.keyboardPopup)try{let e=I("openSystemKeyboard");if(e?.openSystemKeyboard){e.openSystemKeyboard();return}if(e?.openSystemKeyboardForLastCreatedInput){e.openSystemKeyboardForLastCreatedInput();return}let t=H?.refs?.[0]?.current;if(t?.focus){t.focus();return}F.Keyboard?.dismiss&&setTimeout(()=>{t?.focus&&t.focus()},50)}catch(e){i.debugMode&&l.error("BetterChatGestures: Error opening keyboard",e)}},patchHandlers(e){if(!this.handlersInstances.has(e)){this.handlersInstances.add(e);try{if(e.handleDoubleTapMessage){let t=te("handleDoubleTapMessage",e,(r,n)=>{try{if(!r?.[0]?.nativeEvent)return;let{nativeEvent:a}=r[0],m=a.channelId,u=a.messageId;if(!m||!u)return;let d=re?.getChannel(m),g=V?.getMessage(m,u);if(!g)return;let S=K?.getCurrentUser();(S&&g.author?g.author.id===S.id:!1)&&i.userEdit?oe?.startEditMessage(m,u,g.content||""):i.reply&&d&&$?.createPendingReply({channel:d,message:g,shouldMention:!0}),this.openKeyboard();return}catch(a){l.error("BetterChatGestures: Error in handleDoubleTapMessage patch",a)}});this.patches.push(t)}if(e.handleTapUsername&&i.tapUsernameMention){let t=te("handleTapUsername",e,(r,n)=>{try{if(!i.tapUsernameMention||!r?.[0]?.nativeEvent)return n.apply(e,r);let a=H?.refs?.[0]?.current,{messageId:m}=r[0].nativeEvent;if(!a?.props?.channel?.id)return n.apply(e,r);let u=V.getMessage(a.props.channel.id,m);if(!u?.author)return n.apply(e,r);let d=u.author.discriminator!=="0"?`#${u.author.discriminator}`:"";H.insertText(`@${u.author.username}${d}`)}catch(a){return l.error("BetterChatGestures: Error in handleTapUsername patch",a),n.apply(e,r)}});this.patches.push(t)}if(e.handleTapMessage){let t=xe("handleTapMessage",e,r=>{try{if(!r?.[0])return;let{nativeEvent:n}=r[0];if(!n)return;let a=n.channelId,m=n.messageId;if(!a||!m)return;let u=re?.getChannel(a),d=V?.getMessage(a,m);if(!d)return;this.currentMessageID===m?this.currentTapIndex++:(this.resetTapState(),this.currentTapIndex=1,this.currentMessageID=m);let g=1e3;if(i.delay){let _=parseInt(i.delay,10);!isNaN(_)&&_>=200&&(g=_)}this.timeoutTap&&clearTimeout(this.timeoutTap),this.timeoutTap=setTimeout(()=>{this.resetTapState()},g);let S=K?.getCurrentUser(),L=S&&d.author?d.author.id===S.id:!1,O={...n,taps:this.currentTapIndex,content:d.content||"",authorId:d.author?.id,isAuthor:L};if(this.currentTapIndex!==2){this.doubleTapState({state:"INCOMPLETE",nativeEvent:O});return}let se=this.currentMessageID;this.resetTapState(),L?i.userEdit?oe?.startEditMessage(a,se,O.content):i.reply&&u&&$?.createPendingReply({channel:u,message:d,shouldMention:!0}):i.reply&&u&&$?.createPendingReply({channel:u,message:d,shouldMention:!0}),this.openKeyboard(),this.doubleTapState({state:"COMPLETE",nativeEvent:O})}catch(n){l.error("BetterChatGestures: Error in handleTapMessage patch",n),this.resetTapState()}});this.patches.push(t)}this.unpatchHandlers=()=>{try{this.patches.forEach(t=>{typeof t=="function"&&t()}),this.patches=[],this.handlersInstances=new WeakSet}catch(t){l.error("BetterChatGestures: Error in unpatchHandlers",t)}}}catch(t){l.error("BetterChatGestures: Error in patchHandlers",t)}}},onLoad(){try{if(!v){l.error("BetterChatGestures: MessagesHandlers module not found! Plugin will not work.");return}i.tapUsernameMention??=F.Platform.select({android:!1,ios:!0,default:!0}),F.Platform.OS==="android"&&(i.tapUsernameMention=!1),i.reply??=!0,i.userEdit??=!0,i.keyboardPopup??=!0,i.delay??="1000",i.debugMode??=!1,(!i.delay||i.delay===""||isNaN(parseInt(i.delay,10))||parseInt(i.delay,10)<200)&&(i.delay="1000"),l.log("BetterChatGestures: initialized with delay =",i.delay);let e=this,t=["params","handlers","_params","messageHandlers"],r=null,n=null;for(let a of t)if(r=Object.getOwnPropertyDescriptor(v.prototype,a)?.get,r){n=a,l.log(`BetterChatGestures: Found property '${a}'`);break}r&&n?(Object.defineProperty(v.prototype,n,{configurable:!0,get(){return this&&e.patchHandlers.call(e,this),r.call(this)}}),this.unpatchGetter=()=>{try{r&&n&&Object.defineProperty(v.prototype,n,{configurable:!0,get:r})}catch(a){l.error("BetterChatGestures: Error in unpatchGetter",a)}}):l.error("BetterChatGestures: Could not find params getter!")}catch(e){l.error("BetterChatGestures: Error in onLoad",e)}},onUnload(){try{this.resetTapState(),this.unpatchGetter&&this.unpatchGetter(),this.unpatchHandlers&&this.unpatchHandlers(),this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null)}catch(e){l.error("BetterChatGestures: Error in onUnload",e)}},settings:ee},mt=ve;export{mt as default};
