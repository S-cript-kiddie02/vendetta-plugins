(function(v,h,t,L,e,w,X,p,M,i){"use strict";var f={Failed:p.getAssetIDByName("Small"),Delete:p.getAssetIDByName("ic_message_delete"),Copy:p.getAssetIDByName("toast_copy_link"),Open:p.getAssetIDByName("ic_leave_stage"),Clipboard:p.getAssetIDByName("pending-alert"),Clock:p.getAssetIDByName("clock"),Forum:p.getAssetIDByName("ic_forum_channel"),Settings:{Toasts:{Settings:p.getAssetIDByName("ic_selection_checked_24px"),Failed:p.getAssetIDByName("ic_close_circle_24px")},Initial:p.getAssetIDByName("coffee"),Update:p.getAssetIDByName("discover"),Locale:p.getAssetIDByName("ic_locale_24px"),External:p.getAssetIDByName("ic_raised_hand_list"),Edit:p.getAssetIDByName("ic_edit_24px"),Reply:p.getAssetIDByName("ic_reply_24px"),Keyboard:p.getAssetIDByName("ic_keyboard_24px")}},E={shadow:function(a=.1){return{shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:a,shadowRadius:4.65,elevation:8}},displayToast:function(a,r){t.toasts.open({content:r=="clipboard"?`Copied ${a} to clipboard.`:a,source:r=="clipboard"?f.Clipboard:f.Settings.Initial})}},U={plugin:{source:"https://github.com/S-cript-kiddie02/vendetta-plugins"},authors:{profile:{"Rosie<3":"https://github.com/acquitelol",MYSTRAVIL:"https://github.com/MYSTRAVIL/vendetta-plugins"}}};const{TouchableOpacity:G,View:O,Image:J,Text:F,Animated:P}=w.General,_=h.findByProps("transitionToGuild"),V=h.findByStoreName("UserStore"),Q=h.findByProps("showUserProfile"),T=t.stylesheet.createThemedStyleSheet({container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",...E.shadow()},image:{width:75,height:75,borderRadius:10,...E.shadow()},mainText:{opacity:.975,letterSpacing:.25},header:{color:M.semanticColors.HEADER_PRIMARY,fontFamily:t.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:M.semanticColors.HEADER_SECONDARY,fontSize:12.75}});function Z({name:a,authors:r}){const s=t.React.useRef(new P.Value(1)).current,n=function(){return P.spring(s,{toValue:1.1,duration:10,useNativeDriver:!0}).start()},o=function(){return P.spring(s,{toValue:1,duration:250,useNativeDriver:!0}).start()},d=function(){return Q.showUserProfile({userId:V.getCurrentUser().id})},c={transform:[{scale:s}]};return t.React.createElement(t.React.Fragment,null,t.React.createElement(O,{style:T.container},t.React.createElement(G,{onPress:d,onPressIn:n,onPressOut:o},t.React.createElement(P.View,{style:c},t.React.createElement(J,{style:[T.image],source:{uri:V?.getCurrentUser()?.getAvatarURL()?.replace("webp","png")}}))),t.React.createElement(O,{style:T.textContainer},t.React.createElement(G,{onPress:function(){return _.openURL(U.plugin.source)}},t.React.createElement(F,{style:[T.mainText,T.header]},a)),t.React.createElement(O,{style:{flexDirection:"row"}},t.React.createElement(F,{style:[T.mainText,T.subHeader]},"A project by"),r.map(function(u,l,g){return t.React.createElement(G,{onPress:function(){return _.openURL(U.author.profile[u.name]??"https://github.com/")}},t.React.createElement(F,{style:[T.mainText,T.subHeader,{paddingLeft:4,fontFamily:t.constants.Fonts.DISPLAY_BOLD,flexDirection:"row"}]},u.name,l<g.length-1?",":null))})))))}const{View:ee,Text:te}=w.General,Y=t.stylesheet.createThemedStyleSheet({text:{color:M.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:12}});function j({label:a,children:r}){return t.React.createElement(ee,{style:{marginTop:10}},t.React.createElement(te,{style:[Y.text,Y.optionText]},a.toUpperCase()),r)}const{FormRow:b,FormSwitch:A,FormDivider:D,FormInput:re,FormText:ae}=w.Forms,{ScrollView:se,View:k,Text:ne}=w.General,R=t.stylesheet.createThemedStyleSheet({icon:{color:M.semanticColors.INTERACTIVE_NORMAL},item:{color:M.semanticColors.TEXT_MUTED,fontFamily:t.constants.Fonts.PRIMARY_MEDIUM},container:{width:"90%",marginLeft:"5%",borderRadius:10,backgroundColor:M.semanticColors.BACKGROUND_MOBILE_SECONDARY,...E.shadow()},subheaderText:{color:M.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:14},image:{width:"100%",maxWidth:350,borderRadius:10}});function oe(){e.storage.tapUsernameMention===void 0&&(e.storage.tapUsernameMention=!1),e.storage.reply===void 0&&(e.storage.reply=!0),e.storage.userEdit===void 0&&(e.storage.userEdit=!0),e.storage.keyboardPopup===void 0&&(e.storage.keyboardPopup=!0),e.storage.delay===void 0&&(e.storage.delay="1000"),X.useProxy(e.storage);const a=t.ReactNative.Platform.OS==="android",r=function(n){/^\d*$/.test(n)&&(e.storage.delay=n)},s=function(){try{t.ReactNative.Linking&&t.ReactNative.Linking.openURL?t.ReactNative.Linking.openURL(U.plugin.source):E.displayToast("Cannot open URL: Linking not available","error")}catch(n){E.displayToast("Error opening URL","error"),console.error("Error opening URL:",n)}};return t.React.createElement(se,null,t.React.createElement(Z,{name:e.manifest.name,authors:e.manifest.authors}),t.React.createElement(k,{style:{marginTop:20}},t.React.createElement(j,{label:"Preferences"},t.React.createElement(k,{style:[R.container]},t.React.createElement(b,{label:"Tap Username to Mention",subLabel:`Allows you to tap on a username to mention them instead of opening their profile.${a?" This option is disabled on Android.":""}`,onLongPress:function(){return E.displayToast("By default, Discord opens a profile when tapping on a username in chat. With this, it now mentions them, like on Android.","tooltip")},leading:t.React.createElement(b.Icon,{style:R.icon,source:e.storage.tapUsernameMention?f.Forum:f.Failed}),trailing:t.React.createElement(A,{value:a?!1:e.storage.tapUsernameMention,onValueChange:function(){a||(e.storage.tapUsernameMention=!e.storage.tapUsernameMention)}}),disabled:a}),t.React.createElement(D,null),t.React.createElement(b,{label:"Double Tap To Reply",subLabel:"Allows you to double tap on any messages to reply to them.",onLongPress:function(){return E.displayToast("Double tapping anyones message allows you to reply to them!","tooltip")},leading:t.React.createElement(b.Icon,{style:R.icon,source:e.storage.reply?f.Settings.Reply:f.Failed}),trailing:t.React.createElement(A,{value:e.storage.reply,onValueChange:function(){e.storage.reply=!e.storage.reply}})}),t.React.createElement(D,null),t.React.createElement(b,{label:"Open Keyboard Automatically",subLabel:"Opens the Keyboard when you reply to or edit a message with a double tap.",onLongPress:function(){return E.displayToast("Opens the Keyboard when you reply to or edit a message with a double tap.","tooltip")},leading:t.React.createElement(b.Icon,{style:R.icon,source:e.storage.keyboardPopup?f.Settings.Keyboard:f.Failed}),trailing:t.React.createElement(A,{value:e.storage.keyboardPopup,onValueChange:function(){e.storage.keyboardPopup=!e.storage.keyboardPopup}})}),t.React.createElement(D,null),t.React.createElement(b,{label:`${e.storage.userEdit?"Double tap to edit":"Double tap to reply to"} your own messages`,subLabel:`Allows you to double tap on any of your own messages to ${e.storage.userEdit?"edit":"reply to"} them.`,onLongPress:function(){return E.displayToast(`When double tapping on any of your own messages, you can now ${e.storage.userEdit?"edit them":"reply to them"}!`,"tooltip")},leading:t.React.createElement(b.Icon,{style:R.icon,source:e.storage.userEdit?f.Settings.Edit:f.Settings.Reply}),trailing:t.React.createElement(A,{value:e.storage.userEdit,onValueChange:function(){e.storage.userEdit=!e.storage.userEdit}})}),t.React.createElement(D,null),t.React.createElement(re,{value:e.storage.delay,onChange:r,placeholder:"1000",title:"Maximum Delay",keyboardType:"numeric"}),t.React.createElement(D,null),t.React.createElement(ae,{style:{padding:10}},"The maximum delay between taps until the double tap event is cancelled. This is 300ms by default."))),t.React.createElement(j,{label:"Source"},t.React.createElement(k,{style:R.container},t.React.createElement(b,{label:"Source",subLabel:`Open the repository of ${e.manifest.name} externally.`,onLongPress:function(){return E.displayToast(`Opens the repository of ${e.manifest.name} on GitHub in an external page to view any source code of the plugin.`,"tooltip")},leading:t.React.createElement(b.Icon,{style:R.icon,source:f.Open}),trailing:function(){return t.React.createElement(b.Arrow,null)},onPress:s})))),t.React.createElement(ne,{style:R.subheaderText},`Build: (${e.manifest.hash?.substring(0,8)||"dev"}`))}const S=h.findByProps("insertText"),W=h.findByStoreName("ChannelStore"),H=h.findByStoreName("MessageStore"),$=h.findByStoreName("UserStore"),z=h.findByProps("sendMessage","startEditMessage"),K=h.findByProps("createPendingReply");let x;try{x=h.findByProps("MessagesHandlers")}catch{i.logger.warn("BetterChatGestures: Could not find MessagesHandlers via findByProps")}if(!x)try{const a=window.vendetta?.metro?.cache||new Map;for(const[r,s]of a)if(s?.exports?.MessagesHandlers){x=s.exports,i.logger.log("BetterChatGestures: Found MessagesHandlers via cache iteration");break}}catch(a){i.logger.error("BetterChatGestures: Failed to find MessagesHandlers via cache",a)}const N=x?.MessagesHandlers,ie={unpatchGetter:null,unpatchHandlers:null,currentTapIndex:0,currentMessageID:null,timeoutTap:null,patches:[],handlersInstances:new WeakSet,isFirstDoubleTapHandled:!1,doubleTapState({state:a="UNKNOWN",nativeEvent:r}){try{const s={state:a,data:r};a==="INCOMPLETE"&&r&&Object.assign(s,{reason:{required:{taps:2,isAuthor:!0},received:{taps:r.taps,isAuthor:r.isAuthor}}});const n=$?.getCurrentUser();n&&e.manifest.authors.find(function(o){return o.id===n.id})&&console.log("DoubleTapState",s)}catch(s){i.logger.error("BetterChatGestures: Error in doubleTapState",s)}},resetTapState(){try{this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null),this.currentTapIndex=0,this.currentMessageID=null}catch(a){i.logger.error("BetterChatGestures: Error in resetTapState",a)}},openKeyboard(){if(!e.storage.keyboardPopup)return;const a=function(r=0){r>3||setTimeout(function(){try{const s=h.findByProps("openSystemKeyboard","openSystemKeyboardForLastCreatedInput");if(s?.openSystemKeyboard){e.storage.debugMode&&i.logger.log("BetterChatGestures: Opening keyboard via openSystemKeyboard"),s.openSystemKeyboard();return}if(s?.openSystemKeyboardForLastCreatedInput){e.storage.debugMode&&i.logger.log("BetterChatGestures: Opening keyboard via openSystemKeyboardForLastCreatedInput"),s.openSystemKeyboardForLastCreatedInput();return}let n=null;if(S?.refs?.[0]?.current&&(n=S.refs[0].current),!n)try{const o=h.findByProps("focus","blur");if(o&&o.focus){o.focus();return}}catch{}if(S?.insertText&&(e.storage.debugMode&&i.logger.log("BetterChatGestures: Attempting to trigger keyboard via insertText"),S.insertText("")),t.ReactNative.findNodeHandle&&n)try{t.ReactNative.findNodeHandle(n)?.focus()}catch{}r<2?a(r+1):e.storage.debugMode&&i.logger.log("BetterChatGestures: All keyboard opening methods failed")}catch(s){e.storage.debugMode&&i.logger.error("BetterChatGestures: Error opening keyboard attempt "+r,s),r<3&&a(r+1)}},r*100+50)};a(0)},patchHandlers(a){var r=this;if(!this.handlersInstances.has(a)){this.handlersInstances.add(a);try{if(a.handleDoubleTapMessage){const s=L.instead("handleDoubleTapMessage",a,function(n,o){try{if(r.isFirstDoubleTapHandled=!0,!n?.[0]?.nativeEvent)return o?.apply(a,n);const{nativeEvent:d}=n[0],c=d.channelId,u=d.messageId;if(!c||!u)return o?.apply(a,n);const l=W?.getChannel(c),g=H?.getMessage(c,u);if(!g)return o?.apply(a,n);const y=$?.getCurrentUser();if(y&&g.author&&g.author.id===y.id&&e.storage.userEdit){z?.startEditMessage(c,u,g.content||""),setTimeout(function(){return r.openKeyboard()},100);return}else if(e.storage.reply&&l){K?.createPendingReply({channel:l,message:g,shouldMention:!0}),setTimeout(function(){return r.openKeyboard()},100);return}return o?.apply(a,n)}catch(d){return i.logger.error("BetterChatGestures: Error in handleDoubleTapMessage patch",d),o?.apply(a,n)}});this.patches.push(s)}if(a.handleTapUsername&&e.storage.tapUsernameMention){const s=L.instead("handleTapUsername",a,function(n,o){try{if(!e.storage.tapUsernameMention||!n?.[0]?.nativeEvent)return o.apply(a,n);const d=S?.refs?.[0]?.current,{messageId:c}=n[0].nativeEvent;if(!d?.props?.channel?.id)return o.apply(a,n);const u=H.getMessage(d.props.channel.id,c);if(!u?.author)return o.apply(a,n);const l=u.author.discriminator!=="0"?`#${u.author.discriminator}`:"";S.insertText(`@${u.author.username}${l}`),setTimeout(function(){return r.openKeyboard()},100)}catch(d){return i.logger.error("BetterChatGestures: Error in handleTapUsername patch",d),o.apply(a,n)}});this.patches.push(s)}if(a.handleTapMessage){const s=L.after("handleTapMessage",a,function(n){try{if(!n?.[0])return;const{nativeEvent:o}=n[0];if(!o)return;const d=o.channelId,c=o.messageId;if(!d||!c)return;const u=W?.getChannel(d),l=H?.getMessage(d,c);if(!l)return;r.currentMessageID===c?r.currentTapIndex++:(r.resetTapState(),r.currentTapIndex=1,r.currentMessageID=c);let g=1e3;if(e.storage.delay){const C=parseInt(e.storage.delay,10);!isNaN(C)&&C>=200&&(g=C)}r.timeoutTap&&clearTimeout(r.timeoutTap),r.timeoutTap=setTimeout(function(){r.resetTapState()},g);const y=$?.getCurrentUser(),m=y&&l.author?l.author.id===y.id:!1,I={...o,taps:r.currentTapIndex,content:l.content||"",authorId:l.author?.id,isAuthor:m};if(r.currentTapIndex!==2){r.doubleTapState({state:"INCOMPLETE",nativeEvent:I});return}const q=r.currentMessageID;r.resetTapState(),m?e.storage.userEdit?(z?.startEditMessage(d,q,I.content),setTimeout(function(){return r.openKeyboard()},100)):e.storage.reply&&u&&(K?.createPendingReply({channel:u,message:l,shouldMention:!0}),setTimeout(function(){return r.openKeyboard()},100)):e.storage.reply&&u&&(K?.createPendingReply({channel:u,message:l,shouldMention:!0}),setTimeout(function(){return r.openKeyboard()},100)),r.doubleTapState({state:"COMPLETE",nativeEvent:I})}catch(o){i.logger.error("BetterChatGestures: Error in handleTapMessage patch",o),r.resetTapState()}});this.patches.push(s)}this.unpatchHandlers=function(){try{r.patches.forEach(function(s){typeof s=="function"&&s()}),r.patches=[],r.handlersInstances=new WeakSet}catch(s){i.logger.error("BetterChatGestures: Error in unpatchHandlers",s)}}}catch(s){i.logger.error("BetterChatGestures: Error in patchHandlers",s)}}},onLoad(){var a,r,s,n,o,d;try{if(!N){i.logger.error("BetterChatGestures: MessagesHandlers module not found! Plugin will not work.");return}(a=e.storage).tapUsernameMention??(a.tapUsernameMention=t.ReactNative.Platform.select({android:!1,ios:!0,default:!0})),t.ReactNative.Platform.OS==="android"&&(e.storage.tapUsernameMention=!1),(r=e.storage).reply??(r.reply=!0),(s=e.storage).userEdit??(s.userEdit=!0),(n=e.storage).keyboardPopup??(n.keyboardPopup=!0),(o=e.storage).delay??(o.delay="1000"),(d=e.storage).debugMode??(d.debugMode=!0),this.isFirstDoubleTapHandled=!1,(!e.storage.delay||e.storage.delay===""||isNaN(parseInt(e.storage.delay,10))||parseInt(e.storage.delay,10)<200)&&(e.storage.delay="1000"),i.logger.log("BetterChatGestures: initialized with delay =",e.storage.delay);const c=this,u=["params","handlers","_params","messageHandlers"];let l=null,g=null;for(const y of u)if(l=Object.getOwnPropertyDescriptor(N.prototype,y)?.get,l){g=y,i.logger.log(`BetterChatGestures: Found property '${y}'`);break}if(l&&g){Object.defineProperty(N.prototype,g,{configurable:!0,get(){return this&&c.patchHandlers.call(c,this),l.call(this)}});const y=function(){try{const m=window.vendetta?.metro?.cache||new Map;let I=!1;for(const[q,C]of m)try{if(C?.exports&&typeof C.exports=="object")for(const le in C.exports){const B=C.exports[le];B&&typeof B=="object"&&(B.handleDoubleTapMessage||B.handleTapMessage||B.handleTapUsername)&&(c.patchHandlers.call(c,B),i.logger.log("BetterChatGestures: Found and patched handler instance"),I=!0)}}catch{}return I||i.logger.log("BetterChatGestures: No instance found, will patch on first access"),I}catch(m){return i.logger.warn("BetterChatGestures: Could not force patch instance",m),!1}};y()||setTimeout(function(){i.logger.log("BetterChatGestures: Retrying instance patching after delay"),y()},1e3),this.unpatchGetter=function(){try{l&&g&&Object.defineProperty(N.prototype,g,{configurable:!0,get:l})}catch(m){i.logger.error("BetterChatGestures: Error in unpatchGetter",m)}}}else i.logger.error("BetterChatGestures: Could not find params getter!")}catch(c){i.logger.error("BetterChatGestures: Error in onLoad",c)}},onUnload(){try{this.resetTapState(),this.unpatchGetter&&this.unpatchGetter(),this.unpatchHandlers&&this.unpatchHandlers(),this.timeoutTap&&(clearTimeout(this.timeoutTap),this.timeoutTap=null)}catch(a){i.logger.error("BetterChatGestures: Error in onUnload",a)}},settings:oe};return v.default=ie,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.components,vendetta.storage,vendetta.ui.assets,vendetta.ui,vendetta);
